*Values
*Units for the values: V, mA, kOhm and mS

* forces current values to be saved
.options savecurrents

***Fonte dependente
Vs 1 3 0 sin(0 30 50 0 0 90)

***Full Wave Rectifier***
Dtl 1 2 Default
Dtr 3 2 Default
Dbl 0 3 Default
Dbr 0 1 Default
*Rrect 2 3 5k

***Envelope detector***
De 2 4 Default
R1 4 0 5k
C 4 0 5u

***Voltage regulator***
R2 4 5 1k
Dr1 5 6 Default
Dr2 6 7 Default
Dr3 7 8 Default
Dr4 8 9 Default
Dr5 9 10 Default
Dr6 10 11 Default
Dr7 11 12 Default
Dr8 12 13 Default
Dr9 13 14 Default
Dr10 14 15 Default
Dr11 15 16 Default
Dr12 16 17 Default
Dr13 17 18 Default
Dr14 18 19 Default
Dr15 19 20 Default
Dr16 20 21 Default
Dr17 21 0 Default
*Dr18 22 23 Default
*Dr19 23 0 Default


.model Default D
.op
.end

.tran 50m 200m

.control

*makes plots in color
set hcopypscolor=0
set color0=white
set color1=black
set color2=red
set color3=blue
set color4=violet
set color5=rgb:3/8/0
set color6=rgb:4/0/0

*3)

*4) 
echo "********************************************"
echo  "Transient analysis"
echo "********************************************"
tran 1e-5 0.2 

***Average***
meas tran yavg AVG v(5) from=50m to=250m

*** max and min v0***
meas tran ymax MAX v(5) from=50m to=250m
meas tran ymin MIN v(5) from=50m to=250m

let vripple_reg = ymax - ymin

print yavg ymax ymin vripple_reg

plot  v(2)-v(3)
hardcopy vrect.ps v(2)-v(3)
echo vrect_FIG

plot  v(5)
hardcopy vout.ps v(5)
echo vout_FIG

plot  v(4)
hardcopy venv.ps v(4)
echo venv_FIG

*5)
plot v(5)-12
hardcopy var_output.ps v(5)-12
echo var_output_FIG


plot v(1)-v(3) v(4) v(5)
hardcopy vs_vout_venv.ps v(1)-v(3) v(4) v(5)
echo vs_vout_venv_FIG

quit
.endc
